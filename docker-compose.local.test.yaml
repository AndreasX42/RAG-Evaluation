version: "3"
services:
  ragflow-test:
    build:
      dockerfile: Dockerfile
      context: ./ragflow
    container_name: ragflow-test
    ports:
      - "8080:8080"
    environment:
      - CHROMADB_HOST=chromadb-test
      - CHROMADB_PORT=8000
      - EXECUTION_CONTEXT=TEST
      - LOG_LEVEL=DEBUG
      - INPUT_LABEL_DATASET=./resources/input_label_dataset.json
    volumes:
      - ./ragflow:/backend/ragflow
      - ./resources/tests:/backend/resources
  chromadb-test:
    build:
      dockerfile: Dockerfile
      context: ./vectorstore
    container_name: chromadb-test
    ports:
      - 8000:8000
    environment:
      - IS_PERSISTENT=TRUE
      - ALLOW_RESET=TRUE
  test-suite:
    build:
      dockerfile: Dockerfile
      context: ./tests
    container_name: tester
    environment:
      - RAGFLOW_HOST=ragflow-test
      - RAGFLOW_PORT=8080
      - CHROMADB_HOST=chromadb-test
      - CHROMADB_PORT=8000
    depends_on:
      - ragflow-test
      - chromadb-test
    volumes:
      - ./resources/tests:/tests/resources
      - ./tests:/tests
